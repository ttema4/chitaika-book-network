<!DOCTYPE html>
<html lang="ru">
{{> header title=user.username metaTitle=user.username}}

    <main class="main">
      <section class="section profile-section">
          
          <div class="profile-header-container">
              
              
              <div class="profile-avatar-wrapper">
                  <figure class="figure profile-figure">
                      <img class="figure__img profile-img" 
                          src="{{#if user.avatar_url}}{{user.avatar_url}}{{else}}https://storage.yandexcloud.net/book-network/images/avatar.png{{/if}}" 
                          alt="Аватар {{user.username}}"
                          loading="eager"
                          onerror="if(!this.dataset.retried){this.dataset.retried=true; this.src=this.src+'?t='+Date.now();}else{this.src='https://storage.yandexcloud.net/book-network/images/avatar.png'; this.onerror=null;}">
                  </figure>
                  
                  {{#if isOwner}}
                  <form action="/users/{{user.id}}/avatar" method="POST" enctype="multipart/form-data" class="profile-avatar-edit">
                       <label for="avatar-input" class="btn-edit-avatar" title="Сменить фото">
                          <img src="https://storage.yandexcloud.net/book-network/images/pencil.png" alt="Edit">
                       </label>
                       <input id="avatar-input" type="file" name="avatar" accept="image/*" style="display: none;" onchange="this.form.submit()">
                  </form>
                  {{/if}}
              </div>

              
              <div class="profile-info">
                  <div style="display: flex; align-items: center; gap: 10px;">
                      <h1 class="title profile-username">{{user.username}}</h1>
                  </div>

                  <p class="profile-email">{{user.email}}</p>
                  
                  
                  <div class="profile-stats">
                      <div class="stat-item subscribers">
                          <div class="stat-value">{{user.subscribers.length}}</div>
                          <div class="stat-label">Подписчиков</div>
                      </div>
                      
                      <div class="stat-divider"></div>

                      <a href="#favorites" class="stat-item favorites">
                          <div class="stat-value">{{user.favorites.length}}</div>
                          <div class="stat-label">Избранное</div>
                      </a>
                      
                      <div class="stat-divider"></div>
                      
                      <a href="#read" class="stat-item read">
                          <div class="stat-value">{{user.booksReadCount}}</div>
                          <div class="stat-label">Прочитано</div>
                      </a>
                      
                      <div class="stat-divider"></div>

                      <div class="stat-item reviews">
                          <div class="stat-value">0</div>
                          <div class="stat-label">Рецензий</div>
                      </div>

                      <div class="stat-divider"></div>

                      <a href="/users/readers" class="stat-item friends">
                          <div class="stat-value">{{user.friends.length}}</div>
                          <div class="stat-label">Подписки</div>
                      </a>

                      {{#unless isOwner}}
                      <div class="stat-divider"></div>
                      {{#if isSubscribed}}
                      <div class="stat-item subscribe-action" data-user-id="{{user.id}}" data-action="unsubscribe" style="cursor: pointer;">
                          <div class="stat-icon">
                              <img src="https://storage.yandexcloud.net/book-network/images/cross.png" alt="Unsubscribe" style="width: 20px; height: 20px;">
                          </div>
                          <div class="stat-label">Отписаться</div>
                      </div>
                      {{else}}
                      <div class="stat-item subscribe-action" data-user-id="{{user.id}}" data-action="subscribe" style="cursor: pointer;">
                          <div class="stat-icon">
                              <img src="https://storage.yandexcloud.net/book-network/images/plus.png" alt="Subscribe" style="width: 20px; height: 20px;">
                          </div>
                          <div class="stat-label">Подписаться</div>
                      </div>
                      {{/if}}
                      {{/unless}}
                      
                      {{#if isOwner}}
                      <div class="stat-divider"></div>
                      <a href="/logout" class="stat-item logout" title="Выйти из аккаунта">
                          <div class="stat-icon">
                              <img src="https://storage.yandexcloud.net/book-network/images/logout.png" alt="Logout" style="width: 20px; height: 20px;">
                          </div>
                          <div class="stat-label">Выйти</div>
                      </a>
                      {{/if}}
                  </div>
              </div>
          </div>
          
          
          {{#if user.reading.length}}
            <section class="section collapsible-section" id="reading">
                <div class="collapsible-header">
                     <h2 class="section__title separator-bottom" style="margin:0; border:none; padding:0;">Читаю сейчас</h2>
                     <div class="collapsible-chevron">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                </div>
                <div class="collapsible-content">
                     <div class="grid--cards" style="margin-top: 20px;">
                        {{#each user.reading}}
                             {{> bookcard}}
                        {{/each}}
                     </div>
                </div>
            </section>
          {{/if}}

          {{#if user.favorites.length}}
            <section class="section collapsible-section" id="favorites">
                <div class="collapsible-header">
                     <h2 class="section__title separator-bottom" style="margin:0; border:none; padding:0;">Избранное</h2>
                     <div class="collapsible-chevron">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                </div>
                <div class="collapsible-content">
                     <div class="grid--cards" style="margin-top: 20px;">
                        {{#each user.favorites}}
                          {{#with this.book}}
                             {{> bookcard}}
                          {{/with}}
                        {{/each}}
                     </div>
                </div>
            </section>
          {{/if}}

          {{#if user.readBooks.length}}
            <section class="section collapsible-section is-collapsed" id="read">
                <div class="collapsible-header">
                     <h2 class="section__title separator-bottom" style="margin:0; border:none; padding:0;">Прочитано</h2>
                     <div class="collapsible-chevron">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                </div>
                <div class="collapsible-content">
                     <div class="grid--cards" style="margin-top: 20px;">
                        {{#each user.readBooks}}
                             {{> bookcard}}
                        {{/each}}
                     </div>
                </div>
            </section>
          {{/if}}
          
          {{#if user.planned.length}}
            <section class="section collapsible-section is-collapsed" id="planned">
                <div class="collapsible-header">
                     <h2 class="section__title separator-bottom" style="margin:0; border:none; padding:0;">Планирую прочитать</h2>
                     <div class="collapsible-chevron">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                </div>
                <div class="collapsible-content">
                     <div class="grid--cards" style="margin-top: 20px;">
                        {{#each user.planned}}
                             {{> bookcard}}
                        {{/each}}
                     </div>
                </div>
            </section>
          {{/if}}

          {{#if recommendations.length}}
            {{#if isOwner}} 
            <section class="section collapsible-section" id="recs">
                <div class="collapsible-header">
                     <h2 class="section__title separator-bottom" style="margin:0; border:none; padding:0;">Друзья читают</h2>
                     <div class="collapsible-chevron">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                </div>
                <div class="collapsible-content">
                     <div class="grid--cards" style="margin-top: 20px;">
                        {{#each recommendations}}
                             {{> bookcard friendName=this.recommender.username friendId=this.recommender.id}}
                        {{/each}}
                     </div>
                </div>
            </section>
            {{/if}}
          {{/if}}

      </section>
    </main>

{{> footer}}
</html>
