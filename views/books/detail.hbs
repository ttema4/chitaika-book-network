<!DOCTYPE html>
<html lang="ru">
{{> header title=book.title metaTitle=book.title}}
    <main class="main">
      <div class="book-detail-container">
        
        <div class="book-detail-cover">
            <figure class="figure book-detail-figure">
            {{#if book.cover_url}}
                <img class="book-detail-img" 
                     src="{{book.cover_url}}" 
                     alt="Обложка книги «{{book.title}}»" 
                     loading="eager"
                     onerror="if(!this.dataset.retried){this.dataset.retried=true; this.src=this.src+'?t='+Date.now();}else{this.src='https://storage.yandexcloud.net/book-network/images/cover.png'; this.onerror=null;}">
            {{else}}
                <img class="book-detail-img" src="https://storage.yandexcloud.net/book-network/images/cover.png" alt="Обложка по умолчанию" style="background: #eee;">
            {{/if}}
            </figure>

            {{#if user}}
            <div class="profile-stats status-widget" data-book-id="{{book.id}}" data-current-status="{{book.userBookStatus}}">
                <div class="stat-item status-option" data-status="none" title="Не читал">
                    <div class="stat-value">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>
                    </div>
                    <div class="stat-label">Не читал</div>
                </div>
                
                <div class="stat-item status-option" data-status="planned" title="В планах">
                    <div class="stat-value">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                    </div>
                    <div class="stat-label">В планах</div>
                </div>

                <div class="stat-item status-option" data-status="reading" title="Читаю">
                    <div class="stat-value">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                    </div>
                    <div class="stat-label">Читаю</div>
                </div>

                <div class="stat-item status-option" data-status="read" title="Прочитал">
                    <div class="stat-value">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                    </div>
                    <div class="stat-label">Прочитал</div>
                </div>
            </div>
            {{else}}
            <div class="auth-message-detail" style="margin-top: 10px; text-align: center; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px;">
                 <div style="font-weight: 500; color: #374151; margin-bottom: 4px;">Статус чтения</div>
                 <div style="color: #6b7280; font-size: 0.9em;">
                    <a href="/login" class="nav__link" style="display:inline-block; padding: 4px 12px; background: var(--ink); color: #fff; margin: 0 4px; font-size: 0.8em;">Войдите</a>
                    чтобы отмечать прочитанное
                 </div>
            </div>
            {{/if}}
        </div>

        
        <div class="book-detail-info">
            <div style="position: relative;">
                <h2 class="section__title book-detail-title" style="padding-right: 120px;">{{book.title}}</h2>
                {{#if book.genre}}
                <span class="book-detail-genre">{{book.genre}}</span>
                {{/if}}
                <p class="card__meta book-detail-author">Автор: {{book.author}}</p>
            </div>

            {{#if book.description}}
            <div class="book-description">
                <h3 class="book-description-title">Описание</h3>
                <p class="book-description-text">{{book.description}}</p>
            </div>
            {{/if}}

            <div class="book-actions">
                <a class="btn btn-primary book-action-read" href="/books/{{book.id}}/read">Читать книгу</a>
                
                <div class="btn-group book-action-row">
                    <a href="/books/{{book.id}}/edit" class="btn btn-secondary btn-sm book-action-edit">Редактировать</a>
                    
                    <form action="/books/{{book.id}}?_method=DELETE" method="POST" onsubmit="return confirm('Вы уверены, что хотите удалить книгу?');" class="book-action-delete">
                        <button type="submit" class="btn btn-danger btn-sm book-action-delete-btn">Удалить</button>
                    </form>
                </div>
            </div>
        </div>
      </div>
    </main>
{{> footer}}
</html>
